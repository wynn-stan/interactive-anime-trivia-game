<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Trivia</title>
</head>
<body>

    <canvas id="canvas" width="1000" height="700">
        
    </canvas>

    <button id="forceButton" onclick="ballIsShot()" >Move ball</button>

    <script type="text/javascript">
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        const forceButton = document.getElementById("forceButton");
       
       let ballRadius = 20;

       let ballPosition = {}; 

       /*
            when canvas loads, set initial ball position
       */
       
       function setInitialBallPosition(){

           ballPosition.x = ballRadius + 10;
           ballPosition.y = canvas.height - ballRadius;

       }

       setInitialBallPosition()

       function drawBall(){
           
            ctx.clearRect(0,0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.arc(ballPosition.x, ballPosition.y, ballRadius, 0, (Math.PI * 2), false);
            ctx.fill();

       }
          
       let x_velocityFactor = 0;
       let y_velocityFactor = 0;

       let x_accelerateFactor = 0;
       let y_accelerateFactor = 0;

       let gravityAcceleration = 0.2;

       /*
            accelerate factor is increase it's velocity
       */

       function setVelocityFactor(x,y){
            x_velocityFactor = x;
            y_velocityFactor = y;
       }

       function setAccelerationFactor(x,y){
            x_accelerateFactor = x;
            y_accelerateFactor = y;
       }

       function accelerate(x_acceleration, y_acceleration){
           x_velocityFactor += x_acceleration;
           y_velocityFactor += y_acceleration;
       }

       function isBallOnGround(){
           let ground = canvas.height - ballRadius - 1;
           let validity = ballPosition.y >= ground;
           return validity;
       }

       function stopMovingBallDownwards(){
            y_velocityFactor = 0;
       }

       let isBallShot = false;

       function ballIsShot(){
           isBallShot = true;
           setVelocityFactor(2, -12);

       }

       /*
            stop ball when it touches the ground
                every frame
                    check if ball has touched ground
                        if yes, 
                            stop ball from moving downwards
       */

       function animateBall(){

           drawBall();

           if(isBallShot == true){
                moveBall45Deg();
                stopBallBoomerangShot();
           }

           if(isBallOnGround() == true){
                stopMovingBallDownwards();
                isBallShot = false;
           }

           requestAnimationFrame(animateBall);
       }

       function moveBall(param_x_factor, param_y_factor){
            ballPosition.x +=  param_x_factor;
            ballPosition.y += param_y_factor;
       }

       /*
            set new velocity/factor
       */

       animateBall();

       /*
            shoot ball 45deg
                when shootball button is pressed, set velocity to 2;
                every frame, 
                check if the shootball button is presssed, then
                        move ball
                            increase ballPosition.x by velocityFactor;
                            increase ballPosition.y by velocityFactor;

                        decelerate ball
                            every frame,
                            decrease ballVelocity by decelerationFactor;
                                let x_velocityFactor -= decelerationFactor;
                                let y_velocityFactor -= decelerationFactor;
                                reduce ball position due to deceleration;
                                    let ballPosition.x -= x_velocityFactor
                                    same for y
                        
                        move ball downwards because of gravity
                            every frame, 
                                decrease ball velocity by gravity
                                    set deceleration factor to that of gravity
                                    let y_velocityfactor += -decelerationFactor;
                                increase ball-y-position by velocituy
                                    let ballPosition.y += y_velocityfactor
       */

       function moveBall45Deg(){

                moveBall(x_velocityFactor, y_velocityFactor);

                let isXVelocity0 = x_velocityFactor >= -0.01 && x_velocityFactor <= 0.01;

                if(isXVelocity0 == true){
                    setAccelerationFactor(0, y_accelerateFactor);
                    decelerateBall(x_accelerateFactor, y_accelerateFactor)
                } else {
                    setAccelerationFactor(0, 0.2);
                    decelerateBall(x_accelerateFactor, y_accelerateFactor);
                }
                

                moveBallDownwardsWithGravity();
       }

       function decelerateBall(x,y){

           x_velocityFactor += x;
           y_velocityFactor += y;

           moveBall(x_velocityFactor, y_velocityFactor)

       }

       function moveBallDownwardsWithGravity(){ 
            setAccelerationFactor(x_accelerateFactor, gravityAcceleration);
            decelerateBall(0, y_accelerateFactor);
       }

       function stopBallBoomerangShot(){

           let isXVelocity0 = x_velocityFactor >= -0.01 && x_velocityFactor <= 0.01;

           if(isXVelocity0 == true){
               stopMovingBallBackwards();
           }

       }

       function stopMovingBallBackwards(){
           console.log(x_accelerateFactor);
           setAccelerationFactor(0, y_accelerateFactor);
       }

       

       /*
            stop ball from moving 45degs backwards and downwards
                every frame
                    check if ball velocity x reaches 0;
                        if yes, 
                            stop decelerating x velocity
                    check if ball y velocity is 0, 
                            stop decelerating y velocity;
       */
       stopBallBoomerangShot();

    </script>

</body>
</html>